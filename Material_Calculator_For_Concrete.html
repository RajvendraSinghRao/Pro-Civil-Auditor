<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Browser Compass</title>
<style>
  body {
    background: #222;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
  }
  h1 { margin-bottom: 10px; }
  #compass {
    width: 250px;
    height: 250px;
    margin: 30px auto;
    background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/Compass_rose_pale.svg/512px-Compass_rose_pale.svg.png') no-repeat center;
    background-size: contain;
    transform: rotate(0deg);
    transition: transform 0.1s linear;
  }
  #direction {
    font-size: 20px;
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>ðŸ§­ True North Compass</h1>
<div id="compass"></div>
<div id="direction">Direction: 0Â°</div>
<button id="startBtn">Start Compass</button>

<script>
let declination = 0; // Will be updated from location
let compassEl = document.getElementById("compass");
let directionEl = document.getElementById("direction");

document.getElementById("startBtn").addEventListener("click", async () => {
  try {
    // Request permission for motion sensors (iOS)
    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
      await DeviceOrientationEvent.requestPermission();
    }
    // Get GPS location to calculate declination
    navigator.geolocation.getCurrentPosition(pos => {
      let lat = pos.coords.latitude;
      let lon = pos.coords.longitude;
      declination = estimateDeclination(lat, lon); // Simple estimate
      startCompass();
    }, err => {
      alert("Location access denied. Can't calculate true north.");
      startCompass();
    });
  } catch (e) {
    alert("Motion or location permissions are required.");
  }
});

function startCompass() {
  window.addEventListener("deviceorientationabsolute", handleOrientation, true);
  window.addEventListener("deviceorientation", handleOrientation, true); // fallback
}

function handleOrientation(event) {
  if (event.absolute === false && !event.webkitCompassHeading) {
    return; // Not supported
  }

  let heading;
  if (event.webkitCompassHeading) {
    // iOS gives compass heading directly
    heading = event.webkitCompassHeading;
  } else {
    // Other devices: alpha is degrees from device's orientation to magnetic north
    heading = 360 - event.alpha;
  }

  // Adjust for declination to get TRUE north
  let trueHeading = (heading + declination + 360) % 360;

  compassEl.style.transform = `rotate(${trueHeading}deg)`;
  directionEl.innerText = `Direction: ${trueHeading.toFixed(1)}Â°`;
}

// Simple declination estimate (approx, not super precise)
function estimateDeclination(lat, lon) {
  // Rough formula: declination changes about 0.2Â° per degree longitude from Greenwich
  // This is just a placeholder, real calculation uses magnetic model (WMM)
  return (lon / 15) * 0.2; 
}
</script>

</body>
</html>
