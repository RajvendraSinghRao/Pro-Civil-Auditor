<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free Live Walking Distance Tracker</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
body { font-family: Arial, sans-serif; max-width: 800px; margin:auto; padding:20px; background:#f0f2f5; }
h2 { text-align:center; color:#333; }
button {
  padding:12px 20px; margin:10px 5px 20px 0; font-size:16px;
  border:none; border-radius:6px; cursor:pointer; background:#007BFF; color:white; transition:0.3s;
}
button:hover { background:#0056b3; }
#map { width: 100%; height: 500px; border-radius:8px; }
#info { background:white; padding:15px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<h2>Live Walking Distance Tracker (Free)</h2>
<button id="startBtn">Start Walking</button>
<button id="stopBtn" disabled>Stop</button>
<div id="info">
  <p><strong>Distance:</strong> <span id="distance">0</span> meters / <span id="distanceFeet">0</span></p>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Initialize map
let map = L.map('map').fitWorld();
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
}).addTo(map);

let path = [];
let polyline = L.polyline([], {color:'red'}).addTo(map);
let watchID;
let totalDistance = 0;

// Convert meters to feet/inches
function metersToFeetInches(meters){
    const totalInches = meters*39.3701;
    const feet = Math.floor(totalInches/12);
    const inches = (totalInches%12).toFixed(2);
    return `${feet}' ${inches}"`;
}

// Haversine distance
function getDistance(lat1, lon1, lat2, lon2){
    const R = 6371e3; // meters
    const φ1 = lat1*Math.PI/180;
    const φ2 = lat2*Math.PI/180;
    const Δφ = (lat2-lat1)*Math.PI/180;
    const Δλ = (lon2-lon1)*Math.PI/180;
    const a = Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
    const c = 2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R*c;
}

// Update info
function updateInfo() {
    document.getElementById('distance').innerText = totalDistance.toFixed(2);
    document.getElementById('distanceFeet').innerText = metersToFeetInches(totalDistance);
}

// Start walking
document.getElementById('startBtn').addEventListener('click', ()=>{
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            const {latitude, longitude} = pos.coords;
            map.setView([latitude, longitude], 18);
            path.push([latitude, longitude]);
            polyline.setLatLngs(path);
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;

            watchID = navigator.geolocation.watchPosition(position=>{
                const newPoint = [position.coords.latitude, position.coords.longitude];
                const lastPoint = path[path.length-1];
                const distance = getDistance(lastPoint[0], lastPoint[1], newPoint[0], newPoint[1]);
                totalDistance += distance;
                path.push(newPoint);
                polyline.setLatLngs(path);
                map.panTo(newPoint);
                updateInfo();
            }, err=>{
                alert("Error getting location: " + err.message);
            }, {enableHighAccuracy:true, maximumAge:0, timeout:5000});

        }, err=>{
            alert("Error getting location: " + err.message);
        }, {enableHighAccuracy:true});
    } else {
        alert("Geolocation not supported.");
    }
});

// Stop walking
document.getElementById('stopBtn').addEventListener('click', ()=>{
    if(watchID) navigator.geolocation.clearWatch(watchID);
    document.getElementById('startBtn').disabled = false;
    document.getElementById('stopBtn').disabled = true;
});
</script>

</body>
</html>
