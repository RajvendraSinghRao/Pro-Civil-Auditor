<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digital Plane Table</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    padding: 20px;
    max-width: 700px;
    margin: auto;
}
h2 {
    text-align: center;
    color: #333;
}
button {
    padding: 12px 20px;
    font-size: 16px;
    margin: 10px 0;
    cursor: pointer;
    border: none;
    background-color: #007BFF;
    color: white;
    border-radius: 6px;
    transition: 0.3s;
}
button:hover {
    background-color: #0056b3;
}
#points {
    margin-top: 20px;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
#points ul {
    list-style-type: none;
    padding-left: 0;
}
#points li {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}
#error {
    color: red;
    margin-top: 10px;
    font-weight: bold;
}
</style>
</head>
<body>

<h2>Digital Plane Table (GPS)</h2>
<button id="markBtn">Mark Current Point</button>
<div id="points">
    <h3>Marked Points:</h3>
    <ul id="pointList"></ul>
</div>
<div id="error"></div>

<script>
// Store points
let points = [];

// Haversine formula in meters
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371e3;
    const φ1 = lat1 * Math.PI/180;
    const φ2 = lat2 * Math.PI/180;
    const Δφ = (lat2-lat1) * Math.PI/180;
    const Δλ = (lon2-lon1) * Math.PI/180;

    const a = Math.sin(Δφ/2)**2 +
              Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c; // meters
}

// Convert meters to feet & inches
function metersToFeetInches(meters) {
    const totalInches = meters * 39.3701;
    const feet = Math.floor(totalInches / 12);
    const inches = (totalInches % 12).toFixed(2);
    return `${feet}' ${inches}"`;
}

// Update list
function updatePointList() {
    const ul = document.getElementById('pointList');
    ul.innerHTML = "";
    points.forEach((p,index) => {
        let distanceMeters = 0;
        let distanceFeet = "";
        if(index > 0) {
            const prev = points[index-1];
            distanceMeters = getDistance(prev.lat, prev.lon, p.lat, p.lon);
            distanceFeet = metersToFeetInches(distanceMeters);
        }
        ul.innerHTML += `<li>
            <strong>Point ${index+1}:</strong> (${p.lat.toFixed(6)}, ${p.lon.toFixed(6)}) 
            ${distanceMeters ? `- Distance: ${distanceMeters.toFixed(2)} m / ${distanceFeet}` : ""}
        </li>`;
    });
}

// Mark current GPS point
document.getElementById('markBtn').addEventListener('click', () => {
    const errorDiv = document.getElementById('error');
    errorDiv.innerText = "";
    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            points.push({lat: pos.coords.latitude, lon: pos.coords.longitude});
            updatePointList();
        }, err => {
            let msg = "";
            switch(err.code) {
                case err.PERMISSION_DENIED: msg="Location permission denied."; break;
                case err.POSITION_UNAVAILABLE: msg="Location unavailable."; break;
                case err.TIMEOUT: msg="Location request timed out."; break;
                default: msg="Unknown error."; break;
            }
            msg += " (Open via HTTPS or GitHub Pages, not local file)";
            errorDiv.innerText = msg;
        }, {enableHighAccuracy:true});
    } else {
        errorDiv.innerText = "Geolocation not supported by this browser.";
    }
});
</script>

</body>
</html>
