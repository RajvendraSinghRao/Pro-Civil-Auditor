<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distance Measurement</title>
<style>
  body { font-family: Arial; text-align: center; background: #f0f0f0; }
  video, canvas { border: 2px solid black; margin-top: 10px; }
  #info { margin-top: 10px; font-size: 18px; }
</style>
</head>
<body>
<h2>Distance Measurement</h2>

<video id="video" width="640" height="480" autoplay></video>
<br>
<button id="captureBtn">Capture Image</button>
<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
<div id="info">Place your object in front of the camera and click Capture.</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const info = document.getElementById('info');
const captureBtn = document.getElementById('captureBtn');

// Rough focal length in pixels (calibrate for your camera if needed)
const FOCAL_LENGTH = 700;

// Start webcam
navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
  video.srcObject = stream;
});

// Capture image
captureBtn.addEventListener('click', () => {
  canvas.style.display = 'block';
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  video.style.display = 'none';
  captureBtn.style.display = 'none';
  info.innerText = 'Enter real-world width of the object (cm):';
  
  // Ask for real object width
  const realWidth = parseFloat(prompt("Enter real-world width of the object in cm:"));
  
  if (isNaN(realWidth) || realWidth <= 0) {
    info.innerText = "Invalid width entered. Reload page to try again.";
    return;
  }
  
  info.innerText = "Draw rectangle around the object on the image.";
  
  // Let user draw rectangle on canvas
  let startX, startY, endX, endY, isDrawing = false;
  
  canvas.onmousedown = (e) => {
    const rect = canvas.getBoundingClientRect();
    startX = e.clientX - rect.left;
    startY = e.clientY - rect.top;
    isDrawing = true;
  };
  
  canvas.onmousemove = (e) => {
    if (!isDrawing) return;
    const rect = canvas.getBoundingClientRect();
    endX = e.clientX - rect.left;
    endY = e.clientY - rect.top;
    // Draw rectangle
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height); // redraw image
    ctx.strokeStyle = 'red';
    ctx.lineWidth = 2;
    ctx.strokeRect(startX, startY, endX-startX, endY-startY);
  };
  
  canvas.onmouseup = () => {
    isDrawing = false;
    const pixelWidth = Math.abs(endX - startX);
    const distance = (realWidth * FOCAL_LENGTH) / pixelWidth;
    info.innerText = `Approx. Distance: ${distance.toFixed(2)} cm`;
  };
});
</script>
</body>
</html>
