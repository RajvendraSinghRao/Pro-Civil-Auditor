<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DWG Concrete Calculator</title>
<script src="https://cdn.jsdelivr.net/npm/dxf-parser@1.0.3/dist/dxf-parser.min.js"></script>
</head>
<body>
<h2>Concrete Quantity Calculator (DWG/DXF)</h2>
<input type="file" id="fileInput" accept=".dxf,.dwg"><br><br>
<label>Slab/Beam Depth (m): </label>
<input type="number" id="depth" step="0.01" value="0.15"><br><br>
<button id="calculateBtn">Calculate Concrete Volume</button>

<h3 id="result"></h3>

<script>
function calculatePolygonArea(points) {
    let sum = 0;
    for (let i=0;i<points.length;i++){
        let j = (i+1) % points.length;
        sum += points[i].x*points[j].y - points[j].x*points[i].y;
    }
    return Math.abs(sum)/2;
}

document.getElementById('calculateBtn').addEventListener('click', () => {
    let file = document.getElementById('fileInput').files[0];
    let depth = parseFloat(document.getElementById('depth').value);
    if(!file || !depth){ alert("Select DXF/DWG file & enter depth"); return; }

    let reader = new FileReader();
    reader.onload = function(e){
        try {
            let parser = new window.DxfParser();
            let dxf = parser.parseSync(e.target.result);
            let totalArea = 0;

            dxf.entities.forEach(ent => {
                if(ent.type === 'LWPOLYLINE' && ent.closed){
                    let points = ent.vertices.map(v => ({x:v.x, y:v.y}));
                    totalArea += calculatePolygonArea(points);
                }
            });

            let volume = totalArea * depth;
            document.getElementById('result').innerHTML =
                `Total slab/beam area: ${totalArea.toFixed(2)} units²<br>
                 Concrete volume: ${volume.toFixed(2)} m³`;

        } catch(err){
            alert("Error parsing DXF/DWG: " + err);
        }
    };
    reader.readAsText(file);
});


  // ✅ When this page opens, mark user as subscribed
  localStorage.setItem("subscribed", "true");
  console.log("User subscription status saved.");

  
</script>
</body>
</html>
