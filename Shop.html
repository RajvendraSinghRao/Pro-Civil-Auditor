<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pencil Sketch → CAD Plan</title>
<style>
  body { font-family: Arial; text-align: center; margin: 20px; }
  canvas { border: 1px solid #ccc; margin-top: 10px; }
</style>
</head>
<body>
<h2>Pencil Sketch to Digital Plan</h2>
<input type="file" id="upload" accept="image/*">
<br><br>
<canvas id="inputCanvas" width="600" height="400"></canvas>
<canvas id="outputCanvas" width="600" height="400"></canvas>

<script async src="https://docs.opencv.org/4.x/opencv.js" onload="cv['onRuntimeInitialized']=onOpenCvReady;"></script>
<script>
function onOpenCvReady() {
  document.getElementById('upload').addEventListener('change', (e) => {
    let file = e.target.files[0];
    if (!file) return;
    let img = new Image();
    img.onload = function() {
      let inputCanvas = document.getElementById('inputCanvas');
      let outputCanvas = document.getElementById('outputCanvas');
      inputCanvas.width = img.width;
      inputCanvas.height = img.height;
      outputCanvas.width = img.width;
      outputCanvas.height = img.height;

      let ctx = inputCanvas.getContext('2d');
      ctx.drawImage(img, 0, 0);

      // Convert to OpenCV Mat
      let src = cv.imread(inputCanvas);
      let dst = new cv.Mat();
      cv.cvtColor(src, src, cv.COLOR_RGBA2GRAY, 0);
      cv.GaussianBlur(src, src, new cv.Size(3,3), 0, 0, cv.BORDER_DEFAULT);
      cv.Canny(src, dst, 50, 150);

      // Convert edges to image
      cv.imshow(outputCanvas, dst);

      src.delete(); dst.delete();
    }
    img.src = URL.createObjectURL(file);
  });
}
</script>
  
  // ✅ When this page opens, mark user as subscribed
  localStorage.setItem("subscribed", "true");
  console.log("User subscription status saved.");
</script>
  
</body>
</html>
