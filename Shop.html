<script async src="https://docs.opencv.org/4.x/opencv.js"></script>
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// Setup camera
navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
  video.srcObject = stream;
});

// Constants
const REAL_WIDTH_CM = 10;
const REAL_HEIGHT_CM = 10;
const FOCAL_LENGTH = 700; // adjust after testing

video.addEventListener('play', () => {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  function processFrame() {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // TODO: Use OpenCV.js to detect your shape or an ArUco marker
    // Example: once detected bounding box = {x,y,w,h}

    // Fake detection for demo (centered square 100px wide)
    let x = canvas.width/2 - 50, y = canvas.height/2 - 50, w = 100, h = 100;

    ctx.strokeStyle = "red";
    ctx.lineWidth = 3;
    ctx.strokeRect(x, y, w, h);

    // Calculate distance using width in pixels
    let distanceCm = (REAL_WIDTH_CM * FOCAL_LENGTH) / w;
    ctx.fillStyle = "yellow";
    ctx.fillText(`Distance: ${distanceCm.toFixed(2)} cm`, x, y-10);

    requestAnimationFrame(processFrame);
  }
  processFrame();
});
</script>
